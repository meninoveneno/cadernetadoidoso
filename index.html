<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Configurações PWA Atualizadas -->
  <meta name="theme-color" content="#007bff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="/manifest.json">
  
  <title>Caderneta Virtual do Idoso</title>
  
  <!-- Ícones PWA Atualizados -->
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/4441/4441163.png">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4441/4441163.png">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 16px; margin: 0; padding: 0; background-color: #f8f9fa; color: #333; }
    .container { max-width: 900px; margin: 20px auto; background: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 30px; border-radius: 12px; position: relative; }
    #homeScreen { text-align: center; padding: 50px 20px; background: linear-gradient(135deg, #007bff, #00bfff); color: #fff; border-radius: 12px; position: relative; }
    #homeScreen h1 { font-size: 36px; margin-bottom: 10px; }
    #homeScreen h2 { font-size: 24px; margin-bottom: 30px; font-weight: 400; }
    #homeScreen img { width: 73.125px; position: absolute; left: 20px; bottom: 20px; }
    #homeScreen button { padding: 12px 20px; border: none; background: #28a745; color: #fff; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: background-color 0.3s; }
    #homeScreen button:hover { background-color: #218838; }
    .tabs { display: flex; overflow-x: auto; padding: 0; list-style: none; border-bottom: 2px solid #e9ecef; margin-bottom: 20px; }
    .tabs li { text-align: center; padding: 12px 20px; font-size: 16px; font-weight: 600; cursor: pointer; background-color: #e9ecef; border-radius: 8px 8px 0 0; transition: all 0.3s ease; flex-shrink: 0; min-width: 120px; margin-right: 8px; color: #495057; }
    .tabs li.active { background-color: #007bff; color: white; box-shadow: 0 4px 6px rgba(0, 123, 255, 0.2); }
    .tabs li:hover { background-color: #0056b3; color: white; }
    .tab-content { display: none; animation: fadeIn 0.5s ease-in-out; }
    .tab-content.active { display: block; }
    form label { display: block; margin-top: 12px; font-size: 16px; font-weight: 600; color: #495057; }
    form input, form select, form textarea { width: 100%; padding: 10px; margin-top: 8px; border: 1px solid #ced4da; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease; }
    form input:focus, form select:focus, form textarea:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1); }
    form textarea { resize: vertical; min-height: 100px; }
    .btn { margin-top: 20px; padding: 12px 20px; border: none; background: #28a745; color: #fff; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: background-color 0.3s; width: 100%; max-width: 200px; }
    .btn:hover { background-color: #218838; }
    #addMedicamento, #addVacina { background: #17a2b8; width: 100%; max-width: 200px; }
    #addMedicamento:hover, #addVacina:hover { background: #117a8b; }
    #monitoramentoBtn { background-color: #ffc107; color: #333; }
    #monitoramentoBtn:hover { background-color: #e0a800; }
    .popup { position: fixed; top: 20px; right: 20px; background: #28a745; color: #fff; padding: 12px 20px; border-radius: 8px; font-size: 16px; opacity: 0; transition: opacity 0.5s; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    .popup.show { opacity: 1; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @media(max-width: 600px) {
      .tabs li { font-size: 14px; padding: 10px 15px; min-width: 100px; }
      button, form input, form select, form textarea { font-size: 14px; padding: 8px; }
      form label { font-size: 14px; }
      .review-buttons { flex-direction: column; gap: 10px; }
      .review-buttons .btn { max-width: 100%; width: 100%; }
    }
    .review-buttons { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
    #monitoramentoOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; z-index: 900; }
    #monitoramentoScreen { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; border-radius: 12px; z-index: 1000; display: none; width: 90%; max-width: 400px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    #monitoramentoScreen h3 { margin-top: 0; color: #333; }
    #monitoramentoScreen button { margin-top: 10px; width: 48%; }
    .vacina-form, .medicamento-form { border: 1px solid #e9ecef; padding: 15px; margin-bottom: 15px; border-radius: 8px; background-color: #f8f9fa; }
    .vacina-form .form-row, .medicamento-form .form-row { display: flex; gap: 10px; margin-bottom: 10px; }
    .vacina-form .form-row label, .medicamento-form .form-row label { flex: 1; }
    .vacina-form .form-row input, .vacina-form .form-row textarea, .medicamento-form .form-row input, .medicamento-form .form-row textarea { flex: 2; }
    .delete-btn { background-color: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-top: 10px; transition: background-color 0.3s; }
    .delete-btn:hover { background-color: #c82333; }
    .review-container { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); }
    .review-container h3 { margin-top: 0; color: #007bff; }
    .alarm-btn { background-color: #ffc107; color: #333; display: flex; align-items: center; gap: 8px; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
    .alarm-btn:hover { background-color: #e0a800; }
    .alarm-btn i { font-size: 18px; }
  </style>
</head>
<body>
  <div id="homeScreen" class="container">
    <h1>Caderneta Virtual do Idoso</h1>
    <h2>Cuidar hoje para viver melhor amanhã! - Grupo D Inovação e Tecnologia em Saúde FUNORTE 2025.1</h2>
    <img src="https://cdn-icons-png.flaticon.com/512/4441/4441163.png" alt="Logo">
    <button id="startBtn">Iniciar</button>
  </div>

  <div id="editScreen" class="container" style="display: none;">
    <ul class="tabs">
      <li class="tab active" data-tab="identificacao">Identificação</li>
      <li class="tab" data-tab="vacinacao">Vacinação</li>
      <li class="tab" data-tab="doencas">Doenças Crônicas</li>
      <li class="tab" data-tab="medicamentos">Medicamentos</li>
      <li class="tab" data-tab="recomendacoes">Anotações</li>
    </ul>

    <div class="tab-content active" id="identificacao">
      <form id="form-identificacao">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome">
        <label for="dataNascimento">Data de Nascimento:</label>
        <input type="date" id="dataNascimento" name="dataNascimento">
        <label for="peso">Peso (kg):</label>
        <input type="number" id="peso" name="peso">
        <label for="contato">Contato:</label>
        <input type="tel" id="contato" name="contato">
        <label for="contatoEmergencia">Contato de Emergência:</label>
        <input type="tel" id="contatoEmergencia" name="contatoEmergencia">
      </form>
    </div>

    <div class="tab-content" id="vacinacao">
      <div id="vacinasContainer">
        <div class="vacina-form">
          <div class="form-row">
            <label for="nomeVacina">Nome da Vacina:</label>
            <input type="text" class="nomeVacina" name="nomeVacina[]">
          </div>
          <div class="form-row">
            <label for="dataAplicacao">Data de Aplicação:</label>
            <input type="date" class="dataAplicacao" name="dataAplicacao[]">
          </div>
          <div class="form-row">
            <label for="loteVacina">Lote:</label>
            <input type="text" class="loteVacina" name="loteVacina[]">
          </div>
          <div class="form-row">
            <label for="observacoesVacina">Observações:</label>
            <textarea class="observacoesVacina" name="observacoesVacina[]"></textarea>
          </div>
          <button type="button" class="delete-btn" onclick="deleteVacinaForm(this)">Excluir Vacina</button>
        </div>
      </div>
      <button type="button" id="addVacina" class="btn">Adicionar Vacina</button>
    </div>

    <div class="tab-content" id="doencas">
      <form id="form-doencas">
        <label><input type="checkbox" id="hipertensao" name="hipertensao"> Hipertensão</label>
        <label><input type="checkbox" id="diabetes" name="diabetes"> Diabetes</label>
        <label><input type="checkbox" id="cardiopatias" name="cardiopatias"> Cardiopatias</label>
        <label><input type="checkbox" id="chagas" name="chagas"> Chagas</label>
        <label for="outrasDoencas">Outras Doenças/Alergias:</label>
        <input type="text" id="outrasDoencas" name="outrasDoencas">
      </form>
    </div>

    <div class="tab-content" id="medicamentos">
      <form id="form-medicamentos">
        <div id="medicamentosContainer">
          <div class="medicamento-form">
            <label>Nome do Medicamento:</label>
            <input type="text" name="nomeMedicamento[]">
            <label>Dose:</label>
            <input type="text" name="doseMedicamento[]">
            <label>Posologia:</label>
            <input type="text" name="posologiaMedicamento[]">
            <label>Horário:</label>
            <input type="time" name="horarioMedicamento[]">
            <button type="button" class="delete-btn" onclick="deleteMedicamentoForm(this)">Excluir Medicamento</button>
          </div>
        </div>
        <button type="button" id="addMedicamento" class="btn">Adicionar Medicamento</button>
      </form>
    </div>

    <div class="tab-content" id="recomendacoes">
      <form id="form-recomendacoes">
        <label for="anotacoes">Anotações Médicas:</label>
        <textarea id="anotacoes" name="anotacoes"></textarea>
      </form>
    </div>

    <button id="saveBtn" class="btn">Salvar Dados</button>
    <div id="popup" class="popup">Dados salvos com sucesso!</div>
  </div>

  <div id="reviewScreen" class="container" style="display: none;">
    <h2>Dados do Idoso</h2>
    <div class="review-container">
      <h3>Identificação</h3>
      <div id="reviewIdentificacao"></div>
    </div>
    <div class="review-container">
      <h3>Vacinação</h3>
      <div id="reviewVacinacao"></div>
    </div>
    <div class="review-container">
      <h3>Doenças Crônicas e Alergias</h3>
      <div id="reviewDoencas"></div>
    </div>
    <div class="review-container">
      <h3>Medicamentos em Uso</h3>
      <div id="reviewMedicamentos"></div>
      <button class="alarm-btn" onclick="setMedicationAlarm()">
        <i class="fas fa-clock"></i>
        Definir alarme para medicações
      </button>
    </div>
    <div class="review-container">
      <h3>Mapeamento de PA e Glicemia</h3>
      <div id="reviewMonitoramento"></div>
    </div>
    <div class="review-container">
      <h3>Recomendações/Anotações Médicas</h3>
      <div id="reviewAnotacoes"></div>
    </div>
    <div class="review-buttons">
      <button id="exportBtn" class="btn">Exportar</button>
      <button id="monitoramentoBtn" class="btn">Monitoramento</button>
      <button id="editBtn" class="btn">Editar</button>
      <button id="deleteAllBtn" class="btn">Excluir todos os dados</button>
    </div>
  </div>

  <div id="monitoramentoOverlay"></div>
  <div id="monitoramentoScreen">
    <h3>Mapeamento de PA e Glicemia</h3>
    <form id="form-monitoramento">
      <label for="paMonitor">Pressão Arterial (PA):</label>
      <input type="text" id="paMonitor" name="paMonitor" placeholder="ex: 120/80">
      <label for="glicemiaMonitor">Glicemia:</label>
      <input type="number" id="glicemiaMonitor" name="glicemiaMonitor">
      <div style="display: flex; justify-content: space-between;">
        <button type="button" id="saveMonitorBtn" class="btn">Salvar Monitoramento</button>
        <button type="button" id="closeMonitorBtn" class="btn">Fechar</button>
      </div>
    </form>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Registro do Service Worker Atualizado
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('Service Worker registrado:', registration.scope);
          })
          .catch(error => {
            console.log('Falha no registro:', error);
          });
      });
    }

    // JavaScript original mantido
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
      });
    });

    document.getElementById('addMedicamento').addEventListener('click', () => {
      const container = document.getElementById('medicamentosContainer');
      const newBlock = document.createElement('div');
      newBlock.classList.add('medicamento-form');
      newBlock.innerHTML = `
        <label>Nome do Medicamento:</label>
        <input type="text" name="nomeMedicamento[]">
        <label>Dose:</label>
        <input type="text" name="doseMedicamento[]">
        <label>Posologia:</label>
        <input type="text" name="posologiaMedicamento[]">
        <label>Horário:</label>
        <input type="time" name="horarioMedicamento[]">
        <button type="button" class="delete-btn" onclick="deleteMedicamentoForm(this)">Excluir Medicamento</button>
      `;
      container.appendChild(newBlock);
    });

    function deleteMedicamentoForm(button) {
      if (confirm("Tem certeza que deseja excluir este medicamento?")) {
        const form = button.closest('.medicamento-form');
        form.remove();
      }
    }

    document.getElementById('addVacina').addEventListener('click', () => {
      const container = document.getElementById('vacinasContainer');
      const newBlock = document.createElement('div');
      newBlock.classList.add('vacina-form');
      newBlock.innerHTML = `
        <div class="form-row">
          <label for="nomeVacina">Nome da Vacina:</label>
          <input type="text" class="nomeVacina" name="nomeVacina[]">
        </div>
        <div class="form-row">
          <label for="dataAplicacao">Data de Aplicação:</label>
          <input type="date" class="dataAplicacao" name="dataAplicacao[]">
        </div>
        <div class="form-row">
          <label for="loteVacina">Lote:</label>
          <input type="text" class="loteVacina" name="loteVacina[]">
        </div>
        <div class="form-row">
          <label for="observacoesVacina">Observações:</label>
          <textarea class="observacoesVacina" name="observacoesVacina[]"></textarea>
        </div>
        <button type="button" class="delete-btn" onclick="deleteVacinaForm(this)">Excluir Vacina</button>
      `;
      container.appendChild(newBlock);
    });

    function deleteVacinaForm(button) {
      if (confirm("Tem certeza que deseja excluir esta vacina?")) {
        const form = button.closest('.vacina-form');
        form.remove();
      }
    }

    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('homeScreen').style.display = 'none';
      document.getElementById('editScreen').style.display = 'block';
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      }
    });
  </script>
</body>
</html>
